{
    "id": 732,
    "status": "Fixed",
    "summary": "ProcessCommonJSModules module$exports failures when checkTypes enabled",
    "labels": [
        "Type-Defect",
        "Priority-Medium"
    ],
    "stars": 0,
    "commentCount": 3,
    "comments": [
        {
            "id": 0,
            "commenterId": -6289268304558982259,
            "content": "If you define a module (echo.js) as:\r\ndefine(function() { return {\r\n  echo: function(val) {\r\n    window.console.log(val);\r\n  }\r\n}});\r\n\r\nand an entry point* that does not define any new modules as:\r\nvar echo = require('echo');\r\necho.echo('hello world');\r\n\r\nand compile with:\r\njava -jar build/compiler.jar --formatting=PRETTY_PRINT --jscomp_error=checkTypes --compilation_level=SIMPLE_OPTIMIZATIONS --transform_amd_modules --process_common_js_modules --js=echo.js --js=echo-main.js --common_js_entry_module=echo-main.js\r\n\r\nYou get the error:\r\necho-main.js:1: ERROR - Property module$exports never defined on module$echo_main\r\n\r\nwhich is probably happening because of ProcessCommonJSModules#emitOptionalModuleExportsOverride is testing a property that doesn't exist. I can try to cook up a patch but it would probably fall back to using goog.isDef and there's probably a cleaner way :)\r\n\r\n\r\n\r\n\r\n*p.s what is the intended definition of entry points that do not define new modules. the following leaves a call to a require function:\r\nrequire(['echo'], function(echo) {\r\n  echo.echo('hello world');\r\n});",
            "timestamp": 1337182651,
            "attachments": []
        },
        {
            "id": 1,
            "commenterId": -7699928860083865744,
            "content": "",
            "timestamp": 1337372159,
            "attachments": []
        },
        {
            "id": 2,
            "commenterId": -7699928860083865744,
            "content": "This issue was closed by revision r1982.",
            "timestamp": 1337697911,
            "attachments": []
        }
    ]
}